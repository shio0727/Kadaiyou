# 6 画像保存先をS3へ移動
6.1 s3バケットを作成 

- 以下画像のように設定 
![s31]() 
![s32]() 
![s33]() 

6.2 EC2にiamロールを付与
- iamロールの作成(ポリシーはAmazonS3FullAccessを選択 
![role1]() 
![role2]() 
![role3]()) 

6.3 アクセスキーの作成 
- IAM→ユーザー→セキュリティ認証情報で作成 
```bash:title 
#アクセスキーはそのまま使用すると危ないので環境変数に変換 
#~/.zshrcに格納 
export AWS_ACCESS_KEY_ID="IAMuserで作成したAccess key ID" 
export AWS_SECRET_ACCESS_KEY="IAMuserで作成したSecret access key" 
#ファイルの更新　
source ~/.zshrc 
```
6.4 storage.ymlを編集 
```bash:title 
amazon:
service: S3
region: ap-northeast-1 
bucket: バケット名
access_key_id: <%= ENV['AWS_ACCESS_KEY_ID'] %>
secret_access_key:  <%= ENV['AWS_SECRET_ACCESS_KEY'] %> 
``` 
[storage.yml](img5/step6/storage.yml)　　

6.5 environments/development.rbの編集 
- local;→amazon; 
[development.rb](img5/step6/development.rb) 

6.6 ngnixとpumaを再起動してS3のオブジェクト確認 
![s3](img5/step6/s3.png)


